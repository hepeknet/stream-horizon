<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<config>
    <sourceDirectory>d:/projects/test/input</sourceDirectory>
    <archiveDirectory>d:/projects/test/archive</archiveDirectory>
	<errorDirectory>d:/projects/test/error</errorDirectory>
	<bulkOutputDirectory>d:/projects/test/bulkOutput</bulkOutputDirectory>
	<connectionProperties>
		<jdbcUrl>jdbc:mysql://localhost:3306/test?user=root&amp;password=shroot</jdbcUrl>
	</connectionProperties>
    <factFeeds>
        <factFeed name="ff1" type="full">
			<fileNameMasks>
				<fileNameMask>.*txt</fileNameMask>
				<fileNameMask>.*zip</fileNameMask>
			</fileNameMasks>
            <nullString>.</nullString>
            <delimiterString>@@</delimiterString>
            <header process="skip">
				<headerParserClassName>CustomHeaderParser</headerParserClassName>
                <eachLineStartsWithCharacter>a</eachLineStartsWithCharacter>
                <attributes>
                    <attribute name="abc" />
                </attributes>
            </header>
            <data process="strict">
                <eachLineStartsWithCharacter>cc</eachLineStartsWithCharacter>
				<dataMappingClassName>DataMapper</dataMappingClassName>
                <attributes>
                    <attribute name="currencyName" />
					<attribute name="currencyBase" />
					<attribute name="measure1" />
					<attribute name="measure2" />
					<attribute name="measure3" />
					<attribute name="measure4" />
                </attributes>
            </data>
            <derivedAttributes>
                <attribute name="abc">1</attribute>
            </derivedAttributes>
            <footer process="strict">
                <eachLineStartsWithCharacter>9</eachLineStartsWithCharacter>
            </footer>
			<bulkDefinition>
				<bulkOutputExtension>data</bulkOutputExtension>
				<bulkLoadInsertStatement>LOAD DATA INFILE '${global.bulkFilePath}' INTO TABLE test_fact FIELDS TERMINATED BY '@@' LINES TERMINATED BY '\n'</bulkLoadInsertStatement>
				<bulkLoadFileDefinition>
					<attributes>
						<attribute name="dimension.currency" />
						<attribute name="feed.measure1" />
						<attribute name="feed.measure2" />
						<attribute name="global.inputFeedFileName" />
						<attribute name="global.inputFeedFileReceivedTimestamp" />
						<attribute name="header.abc" />
						<attribute name="feed.measure3" />
						<attribute name="feed.measure4" />
						<attribute name="dimension.currency" />
					</attributes>
				</bulkLoadFileDefinition>
			</bulkDefinition>
			<threadPoolSizes>
				<feedProcessingThreads>2</feedProcessingThreads>
				<bulkLoadProcessingThreads>0</bulkLoadProcessingThreads>
			</threadPoolSizes>
        </factFeed>
    </factFeeds>
    <dimensions>
        <dimension name="currency" type="T1_INSERT_ONLY">
			<naturalKeys>
				<naturalKey name="currencyName" />
				<naturalKey name="currencyBase" />
			</naturalKeys>
			<sqlStatements>
				<insertSingle>insert into dim_currency(currency_name, currency_base, created_date) values ('${currencyName}', '${currencyBase}', NOW())</insertSingle>
				<selectSurrogateKey>select id from dim_currency where currency_name = '${currencyName}' and currency_base = '${currencyBase}'</selectSurrogateKey>
			</sqlStatements>
        </dimension>
    </dimensions>
</config>
